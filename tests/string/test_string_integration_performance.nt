use time;

say("=== String Integration and Performance Tests ===");

// Track test failures
var failureCount = 0;

// Test 1: Backward compatibility
say("Test 1: Backward compatibility");
var compat_str = "Hello World";
var compat_tests = (
    // Original methods still work
    compat_str.length == 11 &&
    compat_str.contains("World") == true &&
    compat_str.substring(0, 5) == "Hello" &&
    compat_str.split(" ").length == 2 &&
    
    // String operators work
    (compat_str + "!") == "Hello World!" &&
    ("test" * 2) == "testtest" &&
    
    // String comparisons work
    compat_str == "Hello World" &&
    compat_str != "hello world"
);

if (compat_tests) {
    say("✓ Backward compatibility maintained");
} else {
    say("✗ Backward compatibility failed");
    failureCount = failureCount + 1;
}

// Test 2: String method integration
say("Test 2: String method integration");
var method_tests = (
    "hello".upper() == "HELLO" &&
    "HELLO".lower() == "hello" &&
    "hello world".find("world") == 6 &&
    "  hello  ".strip() == "hello" &&
    "hello".replace("l", "x") == "hexxo"
);

if (method_tests) {
    say("✓ String methods work correctly");
} else {
    say("✗ String methods failed");
    failureCount = failureCount + 1;
}

// Test 3: Character classification
say("Test 3: Character classification");
var class_tests = (
    "abc123".isalnum() == true &&
    "abc".isalpha() == true &&
    "123".isdigit() == true &&
    "hello".islower() == true &&
    "HELLO".isupper() == true
);

if (class_tests) {
    say("✓ Character classification works");
} else {
    say("✗ Character classification failed");
    failureCount = failureCount + 1;
}

// Test 4: Method chaining
say("Test 4: Method chaining");
var chain_result = "  hello world  ".strip().upper();
if (chain_result == "HELLO WORLD") {
    say("✓ Method chaining works");
} else {
    say("✗ Method chaining failed");
    failureCount = failureCount + 1;
}

// Test 5: Performance validation
say("Test 5: Performance validation");
var perf_base = "Hello World! ";
var perf_str = perf_base * 50;  // Smaller test to avoid issues

var start_time = time.now();
var perf_result = perf_str.upper().lower().strip();
var end_time = time.now();
var duration = end_time - start_time;

var performance_ok = (
    perf_result.length > 500 &&
    perf_result.contains("hello world") &&
    duration < 1000  // Should complete in less than 1 second
);

if (performance_ok) {
    say("✓ Performance validation passed (" + duration + "ms)");
} else {
    say("✗ Performance validation failed");
    failureCount = failureCount + 1;
}

// Test 6: Unicode and special characters
say("Test 6: Unicode and special characters");
var unicode_tests = (
    "café".length == 5 &&
    "café".isunicode() == true &&
    "café".upper() == "CAFÉ"  // Now this should work!
);

if (unicode_tests) {
    say("✓ Unicode handling works");
} else {
    say("✗ Unicode handling failed");
    failureCount = failureCount + 1;
}

// Final summary
say("");
say("=== Integration and Performance Summary ===");
if (failureCount == 0) {
    say("ALL STRING FUNCTIONALITY VALIDATED!");
    say("Python string parity implementation is complete and working!");
} else {
    say("TESTS FAILED: " + failureCount + " test(s) failed");
    say("String functionality validation incomplete");
}

say("=== String Integration and Performance Tests Complete ===");