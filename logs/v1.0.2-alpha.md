# Neutron v1.0.2-alpha Changelog

**Release Date:** October 6, 2025  
**Branch:** alpha  
**Build Status:** âœ… Stable

---

## ğŸ‰ New Features

### Match Statement (Pattern Matching)
**Priority:** High  
**Status:** âœ… Fully Implemented

Added pattern matching support for cleaner conditional logic.

**Syntax:**
```neutron
match (value) {
    case 1 => say("One");
    case 2 => say("Two");
    case 3 => say("Three");
    default => say("Other");
}
```

**Features:**
- âœ… Match with numbers, strings, booleans, and expressions
- âœ… Single-line cases with arrow operator (`=>`)
- âœ… Block statement cases with curly braces
- âœ… Optional default case
- âœ… Nested match statements
- âœ… Match in loops and functions

**Implementation:**
- New tokens: `MATCH`, `CASE`, `DEFAULT`, `ARROW` (`=>`)
- New AST nodes: `MatchStmt`, `MatchCase`
- Bytecode operations: `OP_DUP`, `OP_EQUAL`, `OP_JUMP_IF_FALSE`
- Test suite: `tests/test_match.nt` (10 comprehensive tests)

**Example:**
```neutron
var day = 3;
match (day) {
    case 1 => say("Monday");
    case 2 => say("Tuesday");
    case 3 => say("Wednesday");
    case 4 => say("Thursday");
    case 5 => say("Friday");
    default => say("Weekend!");
}
```

---

### Lambda Functions (Anonymous Functions)
**Priority:** Medium  
**Status:** âœ… Fully Implemented

Added support for inline anonymous functions.

**Syntax:**
```neutron
var add = fun(a, b) {
    return a + b;
};
```

**Features:**
- âœ… Anonymous function expressions
- âœ… Parameters and return values
- âœ… Multiple statements in function body
- âœ… Lambdas stored in variables
- âœ… Lambdas stored in arrays
- âœ… Lambdas passed as function arguments
- âœ… Immediately invoked lambda expressions (IILE)

**Implementation:**
- New expression type: `FunctionExpr`
- New bytecode operation: `OP_CLOSURE`
- Compiler creates nested scope for lambda bodies
- Test suite: `tests/test_lambda_comprehensive.nt` (8 comprehensive tests)

**Examples:**
```neutron
// Basic lambda
var square = fun(x) {
    return x * x;
};
say(square(5));  // 25

// Lambda with no parameters
var greet = fun() {
    return "Hello!";
};
say(greet());  // Hello!

// Lambdas in arrays
var operations = [
    fun(x) { return x + 10; },
    fun(x) { return x * 2; },
    fun(x) { return x * x; }
];
say(operations[0](5));  // 15
say(operations[1](5));  // 10
say(operations[2](5));  // 25

// Lambda as function argument
fun applyTwice(f, value) {
    return f(f(value));
}
var double = fun(x) { return x * 2; };
say(applyTwice(double, 5));  // 20

// Immediately invoked lambda
var result = fun(x) { return x + 1; }(5);
say(result);  // 6
```

---

### Try-Catch Exception Handling (Infrastructure)
**Priority:** Medium  
**Status:** âš ï¸ Partial Implementation

Added foundational infrastructure for exception handling.

**Completed:**
- âœ… New tokens: `TRY`, `CATCH`, `FINALLY`, `THROW`
- âœ… AST structures: `TryStmt`, `ThrowStmt`
- âœ… Parser methods for try-catch-finally syntax
- âœ… Compiler method stubs

**Deferred:**
- â³ Full VM exception handling with stack unwinding
- â³ Exception object type
- â³ Exception propagation

**Note:** Complete implementation deferred due to complexity. Infrastructure in place for future development.

---

## ğŸ› Bug Fixes

### Match Statement Stack Management
**Issue:** Stack underflow error when matching multiple cases  
**Symptom:** Runtime error "Stack underflow" after second or third case  
**Root Cause:** `OP_JUMP_IF_FALSE` opcode already pops the condition from stack  
**Fix:** Removed duplicate `POP` instruction after conditional jumps  
**Status:** âœ… Fixed - All match tests passing

---

## ğŸ”§ Technical Improvements

### New Bytecode Operations
- **OP_DUP:** Duplicates value on top of stack (used in match statements)
- **OP_CLOSURE:** Creates closure from function constant (used in lambda functions)

### Compiler Enhancements
- Added nested compiler support for lambda function bodies
- Improved scope management for local variables
- Enhanced expression parsing for function expressions

### Parser Improvements
- New parsing methods: `matchStatement()`, `lambdaFunction()`
- Support for arrow operator (`=>`) in match cases
- Expression-based function definitions

---

## ğŸ“š Documentation Updates

### Updated Files:
- **docs/ROADMAP.md** - Updated task status for items 6, 7, 8
- **docs/language_reference.md** - Added complete documentation:
  - Match statement syntax and examples
  - Lambda function syntax and examples
- **docs/IMPLEMENTATION_SUMMARY.md** - New file with implementation details

---

## ğŸ§ª Test Coverage

### New Test Files:
- `tests/test_match.nt` - 10 comprehensive match statement tests
- `tests/test_lambda_comprehensive.nt` - 8 comprehensive lambda function tests

### Test Results:
```bash
âœ… tests/test_match.nt                    # 10/10 PASS
âœ… tests/test_lambda_comprehensive.nt     # 8/8 PASS
```

---

## ğŸ“¦ Modified Files

### Header Files (11 files):
- `include/token.h` - Added new token types
- `include/expr.h` - Added FunctionExpr class
- `include/stmt.h` - Added MatchStmt, TryStmt, ThrowStmt
- `include/compiler.h` - Updated interface
- `include/compiler/compiler.h` - Added visitor methods
- `include/compiler/parser.h` - Added parsing methods
- `include/compiler/bytecode.h` - Added OP_DUP, OP_CLOSURE

### Source Files (4 files):
- `src/compiler/scanner.cpp` - Token recognition for new keywords
- `src/compiler/parser.cpp` - Parsing logic for match and lambda
- `src/compiler/compiler.cpp` - Bytecode generation for new features
- `src/vm.cpp` - VM execution for OP_DUP and OP_CLOSURE

### Documentation Files (3 files):
- `docs/ROADMAP.md` - Updated
- `docs/language_reference.md` - Updated
- `docs/IMPLEMENTATION_SUMMARY.md` - New

### Test Files (2 new):
- `tests/test_match.nt` - New
- `tests/test_lambda_comprehensive.nt` - New

---

## ğŸš€ Build & Run

```bash
# Build the project
cmake --build build

# Run match tests
./neutron tests/test_match.nt

# Run lambda tests
./neutron tests/test_lambda_comprehensive.nt

# Try your own code
./neutron myfile.nt
```

---

## ğŸ”® Future Enhancements

### Planned for Next Release:
1. **Full Closure Support** - Implement upvalues for capturing outer scope variables
2. **Complete Try-Catch** - Full exception handling with stack unwinding
3. **Pattern Matching Extensions** - Destructuring in match cases
4. **Arrow Function Syntax** - Shorter lambda syntax: `(x) => x * 2`

---

## ğŸ“ Notes

This is an alpha release. Features are stable and tested but may undergo changes based on feedback. Please report any issues on the GitHub repository.

**Previous Version:** 1.0.1-alpha  
**Next Version:** 1.0.3-alpha (planned)

---

**Happy Coding with Neutron! ğŸš€**
