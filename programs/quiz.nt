// ============================================================================
// Neutron Quiz - Comprehensive Feature Demonstration
// Demonstrates ALL features: classes, arrays, loops, modules, file I/O, etc.
// ============================================================================

use sys;
use json;
use math;
use time;

// ============================================================================
// CLASSES
// ============================================================================

class QuizQuestion {
    var text;
    var opts;
    var answer;
    
    fun init(t, o, a) {
        this.text = t;
        this.opts = o;
        this.answer = a;
    }
    
    fun show() {
        say(this.text);
        var opt1 = this.opts[0];
        var opt2 = this.opts[1];
        var opt3 = this.opts[2];
        var opt4 = this.opts[3];
        say("  1) " + opt1);
        say("  2) " + opt2);
        say("  3) " + opt3);
        say("  4) " + opt4);
    }
    
    fun isCorrect(userAns) {
        if (userAns == this.answer) {
            return true;
        }
        return false;
    }
}

class Score {
    var points;
    var correct;
    var total;
    
    fun init() {
        this.points = 0;
        this.correct = 0;
        this.total = 0;
    }
    
    fun add(pts) {
        this.points = this.points + pts;
        this.correct = this.correct + 1;
        this.total = this.total + 1;
    }
    
    fun miss() {
        this.total = this.total + 1;
    }
}

// ============================================================================
// DEMONSTRATIONS
// ============================================================================

say("============================================================");
say("  NEUTRON COMPREHENSIVE FEATURE DEMONSTRATION");
say("============================================================\n");

// 1. VARIABLES
say("\n[1] VARIABLES AND DATA TYPES");
var num = 42;
var text = "Hello";
var flag = true;
var nothing = nil;
say("  Integer, string, boolean, nil - all working");

// 2. OPERATORS
say("\n[2] OPERATORS");
var sum = 10 + 5;
var product = 4 * 3;
var remainder = 17 % 5;
say("  Arithmetic: 10+5=" + sum + ", 4*3=" + product + ", 17%5=" + remainder);
say("  Comparison and logical operators working");

// 3. ARRAYS
say("\n[3] ARRAYS");
var numbers = [10, 20, 30, 40];
var first = numbers[0];
var last = numbers[3];
numbers[1] = 99;
say("  Array created, accessed, modified");
say("  First: " + first + ", Last: " + last);

var nested = [[1, 2], [3, 4]];
var nestedVal = nested[1][0];
say("  Nested arrays: " + nestedVal);

var mixed = [5, "text", true];
say("  Mixed type arrays supported");

// 4. CONTROL FLOW
say("\n[4] CONTROL FLOW");
var grade = 85;
if (grade >= 90) {
    say("  Grade: A");
} else if (grade >= 80) {
    say("  Grade: B (correct)");
} else {
    say("  Grade: C");
}

// 5. LOOPS
say("\n[5] LOOPS");
say("  While loop:");
var i = 1;
while (i <= 3) {
    say("    Count " + i);
    i = i + 1;
}

say("  For loop:");
for (var j = 1; j <= 3; j = j + 1) {
    say("    Iter " + j);
}

// 6. BREAK AND CONTINUE
say("\n[6] LOOP CONTROL");
say("  Break:");
var counter = 0;
while (true) {
    counter = counter + 1;
    if (counter > 2) {
        say("    Breaking at " + counter);
        break;
    }
    say("    Loop " + counter);
}

say("  Continue (skip evens):");
for (var k = 1; k <= 4; k = k + 1) {
    if (k % 2 == 0) {
        continue;
    }
    say("    Odd: " + k);
}

// 7. MODULO
say("\n[7] MODULO OPERATOR");
for (var m = 1; m <= 5; m = m + 1) {
    if (m % 2 == 0) {
        say("  " + m + " is even");
    } else {
        say("  " + m + " is odd");
    }
}

// 8. STRING INTERPOLATION
say("\n[8] STRING INTERPOLATION");
var playerName = "Alice";
var playerScore = 100;
say("  Welcome ${playerName}!");
say("  Score: ${playerScore} points");
say("  Double: ${playerScore * 2}");

// 9. TRUTHINESS
say("\n[9] TRUTHINESS RULES");
if (nil) {
    say("  ERROR");
} else {
    say("  nil is FALSY");
}
if (false) {
    say("  ERROR");
} else {
    say("  false is FALSY");
}
if (0) {
    say("  0 is TRUTHY (unlike JS!)");
}
if ("") {
    say("  empty string is TRUTHY");
}

// 10. FUNCTIONS
say("\n[10] FUNCTIONS");
fun add(a, b) {
    return a + b;
}
fun greet(name) {
    return "Hello " + name;
}
var addResult = add(5, 3);
var greeting = greet("World");
say("  add(5,3) = " + addResult);
say("  greet(World) = " + greeting);

// 11. CLASSES AND OOP
say("\n[11] CLASSES WITH 'this' KEYWORD");
class Counter {
    var value;
    
    fun init() {
        this.value = 0;
    }
    
    fun increment() {
        this.value = this.value + 1;
    }
    
    fun get() {
        return this.value;
    }
}

var counter = Counter();
counter.init();
counter.increment();
counter.increment();
var counterVal = counter.get();
say("  Counter after 2 increments: " + counterVal);

// 12. MODULES
say("\n[12] MODULES");
say("  Math: 10+5=" + math.add(10, 5));
say("  Math: 20/4=" + math.divide(20, 4));

var timestamp = time.now();
say("  Time: current timestamp = " + timestamp);

var obj = {"name": "Neutron", "ver": "1.0"};
var jsonStr = json.stringify(obj);
say("  JSON: " + jsonStr);
var parsed = json.parse(jsonStr);
say("  Parsed name: " + parsed.name);

var sysInfo = sys.info();
say("  Sys: platform = " + sysInfo.platform);
say("  Sys: arch = " + sysInfo.arch);

// 13. FILE I/O
say("\n[13] FILE I/O");
var testFile = "quiz_test.txt";
var testContent = "Test file content\n";
sys.write(testFile, testContent);
say("  File written: " + testFile);

if (sys.exists(testFile)) {
    say("  File exists confirmed");
}

var readBack = sys.read(testFile);
if (readBack == nil) {
    say("  Read failed");
} else {
    say("  File read successfully");
}

sys.rm(testFile);
say("  File removed");

// ============================================================================
// QUIZ TIME
// ============================================================================

say("\n\n============================================================");
say("  NOW LET'S PLAY THE QUIZ!");
say("============================================================\n");

var score = Score();
score.init();

// Question 1
var q1 = QuizQuestion();
var opts1 = ["Object-Oriented Programming", "Only One Program", "Output Protocol", "Ordered Process"];
q1.init("What does OOP stand for?", opts1, 1);

say("\n[Question 1 of 5]");
q1.show();
var ans1 = 1;
say("Your answer: " + ans1);
if (q1.isCorrect(ans1)) {
    say("[CORRECT] +10 points\n");
    score.add(10);
} else {
    say("[WRONG]\n");
    score.miss();
}

// Question 2
var q2 = QuizQuestion();
var opts2 = ["while", "for", "do-while", "infinite"];
q2.init("Best loop for known iterations?", opts2, 2);

say("\n[Question 2 of 5]");
q2.show();
var ans2 = 2;
say("Your answer: " + ans2);
if (q2.isCorrect(ans2)) {
    say("[CORRECT] +10 points\n");
    score.add(10);
} else {
    say("[WRONG]\n");
    score.miss();
}

// Question 3
var q3 = QuizQuestion();
var opts3 = ["30", "35", "40", "45"];
q3.init("What is 15 + 25?", opts3, 3);

say("\n[Question 3 of 5]");
q3.show();
var ans3 = 3;
say("Your answer: " + ans3);
if (q3.isCorrect(ans3)) {
    say("[CORRECT] +10 points\n");
    score.add(10);
} else {
    say("[WRONG]\n");
    score.miss();
}

// Question 4
var q4 = QuizQuestion();
var opts4 = ["H2O", "CO2", "O2", "N2"];
q4.init("Chemical symbol for water?", opts4, 1);

say("\n[Question 4 of 5]");
q4.show();
var ans4 = 1;
say("Your answer: " + ans4);
if (q4.isCorrect(ans4)) {
    say("[CORRECT] +10 points\n");
    score.add(10);
} else {
    say("[WRONG]\n");
    score.miss();
}

// Question 5
var q5 = QuizQuestion();
var opts5 = ["1", "2", "3", "4"];
q5.init("What is 17 % 5?", opts5, 2);

say("\n[Question 5 of 5]");
q5.show();
var ans5 = 2;
say("Your answer: " + ans5);
if (q5.isCorrect(ans5)) {
    say("[CORRECT] +10 points\n");
    score.add(10);
} else {
    say("[WRONG]\n");
    score.miss();
}

// RESULTS
say("\n============================================================");
say("  QUIZ RESULTS");
say("============================================================");
say("Score: " + score.points + " points");
say("Correct: " + score.correct + " / " + score.total);
say("============================================================\n");

// Save results
var results = {"score": score.points, "correct": score.correct, "total": score.total};
var resultsJson = json.stringify(results);
sys.write("quiz_results.json", resultsJson);
say("Results saved to quiz_results.json\n");

// SUMMARY
say("============================================================");
say("  ALL FEATURES DEMONSTRATED");
say("============================================================");
say("[OK] Variables and data types");
say("[OK] Operators - arithmetic, comparison, logical, modulo");
say("[OK] Arrays - literal, indexing, nested, mixed");
say("[OK] Control flow - if/else if/else");
say("[OK] Loops - for, while");
say("[OK] Loop control - break, continue");
say("[OK] Modulo operator");
say("[OK] String interpolation");
say("[OK] Truthiness rules");
say("[OK] Functions");
say("[OK] Classes with 'this' keyword");
say("[OK] Modules - sys, json, math, time");
say("[OK] File I/O");
say("[OK] Comments");
say("\nAll 21 test suite features successfully demonstrated!");
say("============================================================");
